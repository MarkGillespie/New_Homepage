let authorizeButton,signoutButton,CLIENT_ID="146075693051-k890p7lhoh0gc19aukn9errckjarapkh.apps.googleusercontent.com",API_KEY="AIzaSyAQV5RVTyHO0UJ1vWXqwaVuwe9c7vYMSsg",DISCOVERY_DOCS=["https://sheets.googleapis.com/$discovery/rest?version=v4"],SCOPES="https://www.googleapis.com/auth/spreadsheets";function handleClientLoad(){authorizeButton=document.getElementById("authorize_button"),signoutButton=document.getElementById("signout_button"),gapi.load("client:auth2",initClient)}function initClient(){gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus),updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()),authorizeButton.onclick=handleAuthClick,signoutButton.onclick=handleSignoutClick})}function updateSigninStatus(e){e?(authorizeButton.style.display="none",signoutButton.style.display="block",google_sheets_initial_call()):(authorizeButton.style.display="block",signoutButton.style.display="none")}function handleAuthClick(e){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(e){gapi.auth2.getAuthInstance().signOut()}function appendPre(e){console.log(e)}function make_sortable(e,t){Sortable.create(e,{group:"localStorage-example",store:{get:function(e){var t=localStorage.getItem(e.options.group.name);return t?t.split("|"):[]},set:function(e){var t=e.toArray();localStorage.setItem(e.options.group.name,t.join("|"))}},handle:t})}let note_sheet_id="1iBMVMUCkargJfssoeFJf-LmugebBcOtOOvXS4TDQGoY",todo_sheet_id="1iBMVMUCkargJfssoeFJf-LmugebBcOtOOvXS4TDQGoY",note_sheet_name="Notes",todo_sheet_name="TODO",note_sheet_range=note_sheet_name+"!A2:C",todo_sheet_range=todo_sheet_name+"!A2:C";function display_note(e,t){let n=document.createElement("li");n.className="post draggable_post";let o=document.createElement("div");o.className="note_handle";let l=document.createElement("div");l.className="note_content",l.innerHTML=t;let a=document.createElement("button");a.className="button",a.innerHTML="Edit",a.addEventListener("click",function(){window.location="edit_note.html?row="+e}),document.getElementById("note_list").appendChild(n),n.appendChild(o),n.appendChild(l),n.appendChild(a)}function display_todo(e,t,n){let o=document.createElement("li");o.className="post draggable_post";let l=document.createElement("div");l.className="todo_handle";let a=document.createElement("div");a.className="todo_content",a.innerHTML=n;let s=document.createElement("button");s.className="button",s.innerHTML="Edit",s.addEventListener("click",function(){window.location="edit_todo.html?row="+e});let d=document.createElement("div");d.className="todo_checkbox";let i=document.createElement("label");d.appendChild(i),d.addEventListener("click",function(){update_todo(e,n,"Yes"),document.getElementById("todo_list").removeChild(o)}),document.getElementById("todo_list").appendChild(o),o.appendChild(l),o.appendChild(a),a.appendChild(d),o.appendChild(s)}function get_google_sheet(e,t,n,o){gapi.client.sheets.spreadsheets.values.get({spreadsheetId:e,range:t}).then(function(e){let t=e.result;for(let e=0;e<t.values.length;e++)n(e+2,t.values[e]);o()},function(e){appendPre("Error: "+e.result.error.message)})}function load_notes(){get_google_sheet(note_sheet_id,note_sheet_range,function(e,t){"Yes"!=t[1]&&display_note(e,t[2])},function(){renderMathInElement(document.getElementById("note_list"),katex_options),make_sortable(document.getElementById("note_list"),"note_handle"),document.getElementById("note_list").style.opacity=1,document.getElementById("note_list").style.display="block",document.getElementById("note_spinner").style.display="none"})}function load_todos(){get_google_sheet(todo_sheet_id,todo_sheet_range,function(e,t){"Yes"!=t[1]&&display_todo(e,t[0],t[2])},function(){renderMathInElement(document.getElementById("todo_list"),katex_options),make_sortable(document.getElementById("todo_list"),"todo_handle"),document.getElementById("todo_list").style.opacity=1,document.getElementById("todo_list").style.display="block",document.getElementById("todo_spinner").style.display="none"})}function load_sheet_data(){load_notes(),load_todos()}function generate_query_string(e){let t="";for(let n in e)t=t.concat("&"+n+"="+encodeURIComponent(e[n]));return t.substring(1)}function insert_new_row(e,t,n){let o={spreadsheetId:e,range:t,valueInputOption:"USER_ENTERED",insertDataOption:"INSERT_ROWS"},l=(new Date).toJSON().slice(0,10).replace(/-/g,"/");console.log(l);let a={majorDimension:"ROWS",values:[[l].concat(n)]};gapi.client.sheets.spreadsheets.values.append(o,a).then(function(e){},function(e){appendPre("Error: "+e.result.error.message)})}function create_new_note(e){insert_new_row(note_sheet_id,note_sheet_range,["No",e])}function create_new_todo(e){insert_new_row(todo_sheet_id,todo_sheet_range,["No",e])}function update_sheet(e,t,n,o){let l=t+"!A"+n+":"+String.fromCharCode(64+o.length+1)+n,a={spreadsheetId:e,range:l,valueInputOption:"USER_ENTERED"},s=(new Date).toJSON().slice(0,10).replace(/-/g,"/");console.log(s);let d={range:l,majorDimension:"ROWS",values:[[s].concat(o)]};gapi.client.sheets.spreadsheets.values.update(a,d).then(function(e){},function(e){appendPre("Error: "+e.result.error.message)})}function update_note(e,t,n){update_sheet(note_sheet_id,note_sheet_name,e,[n,t])}function update_todo(e,t,n){update_sheet(todo_sheet_id,todo_sheet_name,e,[n,t])}function parse_query_string(){let e={},t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]||"")}return e}function load_editing_todo(){let e=parse_query_string();get_google_sheet(todo_sheet_id,todo_sheet_range,function(t,n){t==e.row&&(document.getElementById("text").value=n[2],preview_todo())},function(){})}function load_editing_note(){let e=parse_query_string();get_google_sheet(note_sheet_id,note_sheet_range,function(t,n){t==e.row&&(document.getElementById("text").value=n[2],preview_note())},function(){})}function delete_note(){let e=parse_query_string(),t=document.getElementById("text").value;update_note(e.row,t,"Yes")}function delete_todo(){let e=parse_query_string(),t=document.getElementById("text").value;update_todo(e.row,t,"Yes")}function save_note(){let e=parse_query_string();console.log(e);let t=document.getElementById("text").value;"row"in e?update_note(e.row,t,"No"):create_new_note(t),preview_note()}function save_todo(){let e=parse_query_string(),t=document.getElementById("text").value;"row"in e?update_todo(e.row,t,"No"):create_new_todo(t),preview_todo()}function preview_note(){let e=document.getElementById("text").value;document.getElementById("preview").innerHTML=e,renderMathInElement(document.getElementById("note_list"),katex_options)}function preview_todo(){let e=document.getElementById("text").value;document.getElementById("preview").innerHTML=e,renderMathInElement(document.getElementById("todo_list"),katex_options)}function getHTML(e,t){let n=function(e,t){};"callback"in t&&(n=t.callback);let o="https://allorigins.me/get?&url="+encodeURIComponent(e),l=new XMLHttpRequest;l.open("GET",o),l.responseType="json",l.onload=function(){let e=l.status;if(200===e){let e=l.response.status.http_code;n(200==e?null:e,l.response.contents)}else n(e,l.response.contents)},l.send()}function getJSON(e,t){let n="",o=function(e,t){};"message"in t&&(n=t.message),"callback"in t&&(o=t.callback);let l=new XMLHttpRequest;l.open("GET",e+"?"+n,!0),l.responseType="json",l.onload=function(){let e=l.status;o(200===e?null:e,l.response)},l.send()}function time_ago(e){let t,n,o=new Date,l=new Date(e),a=(o-l)/6e4;if(a<60)t=Math.floor(a),n="minute";else if(a<1440)t=Math.floor(a/60),n="hour";else if(a<10080)t=Math.floor(a/1440),n="day";else{let e=o.getMonth()-l.getMonth(),a=o.getYear()-l.getYear();a<1?(t=e,n="month"):(t=a,n="year")}return t>1&&(n+="s"),t+" "+n+" ago"}function display_hn_post(e){let t=document.createElement("div");t.className="post hackernews_post";let n=document.createElement("div");n.innerHTML=e.title,n.className="title";let o=document.createElement("a");o.href=e.url,o.className="no_underline";let l=document.createElement("div"),a=time_ago(1e3*e.time);l.innerHTML="posted "+a+" | "+e.descendants+" comments",l.className="details";let s=document.createElement("a");s.href="https://news.ycombinator.com/item?id="+e.id,s.className="no_underline",document.getElementById("hackernews_posts").appendChild(t),t.appendChild(o),t.appendChild(s),o.appendChild(n),s.appendChild(l)}function load_and_display_hn_post(e){getJSON("https://hacker-news.firebaseio.com/v0/item/"+e+".json",{callback:function(e,t){null!==e?alert("Something went wrong: "+e):display_hn_post(t)}})}function load_hackernews(e){getJSON("https://hacker-news.firebaseio.com/v0/topstories.json",{callback:function(t,n){if(document.getElementById("hackernews_posts").style.display="block",document.getElementById("hackernews_spinner").style.display="none",null!==t)alert("Something went wrong: "+t);else{for(let t in n.slice(0,e))load_and_display_hn_post(n[t]);document.getElementById("hackernews_posts").style.opacity=1}}})}function display_reddit_post(e,t){let n=document.createElement("div");n.className="post reddit_post";let o=document.createElement("div");o.innerHTML=e.title,o.className="title";let l=document.createElement("a");l.href=e.url,l.className="no_underline";let a=document.createElement("div"),s=time_ago(1e3*e.created_utc);a.innerHTML="submitted "+s+" | "+e.num_comments+" comments",a.className="details";let d=document.createElement("a");d.href="http://www.reddit.com"+e.permalink,d.className="no_underline",document.getElementById(t+"_posts").appendChild(n),n.appendChild(l),n.appendChild(d),l.appendChild(o),d.appendChild(a)}function load_subreddit(e,t){getJSON("https://www.reddit.com/r/"+e+"/.json?limit="+t,{callback:function(t,n){if(document.getElementById(e+"_posts").style.display="block",document.getElementById(e+"_spinner").style.display="none",null!==t)alert("Something went wrong: "+t);else{for(let t in n.data.children)display_reddit_post(n.data.children[t].data,e);document.getElementById(e+"_posts").style.opacity=1}}})}function display_nlab_page(e){let t=document.createElement("div");t.className="post nlab_post",t.id="nlab_post";let n=document.createElement("div");n.className="nlab_post_heading";let o=document.createElement("span");o.innerHTML="nlab";let l=document.createElement("h1");l.innerHTML=e.title,l.className="nlab_title",n.appendChild(o),n.appendChild(l);let a=document.createElement("a");a.href=e.url,a.className="no_underline";let s=document.createElement("div");s.className="post_body",e.contents.forEach(function(e){s.appendChild(e)}),document.getElementById("nlab_posts").appendChild(t),t.appendChild(a),t.appendChild(s),a.appendChild(n)}function load_nlab_page(e,t){console.log(e,t);getHTML(t,{callback:function(n,o){if(null!==n)alert("Something went wrong: "+n);else{let n=(new DOMParser).parseFromString(o,"text/xml").getElementById("revision").childNodes[0];for(;n&&"contents"!==n.id&&"maruku_toc"!==n.className;)n=n.nextSibling;let l=[];if(n)for(l=[n],n=n.nextSibling;n&&"h2"!==n.tagName;)l.push(n),n=n.nextSibling;l.length<2?alert("Something went wrong: nlab page + "+t+" has no content"):(document.getElementById("nlab_spinner").style.display="none",display_nlab_page({title:e,url:t,contents:l}),document.getElementById("nlab_posts").style.opacity=1,MathJax.Hub.Queue(["Typeset",MathJax.Hub,"nlab"]))}}})}function load_nlab(){console.log(nlab_pages);let e=Object.keys(nlab_pages),t=e[Math.floor(Math.random()*e.length)],n=nlab_pages[t];console.log(n),load_nlab_page(t,n)}function load_posts(){load_hackernews(20),load_subreddit("AskReddit",20),load_nlab()}function get_background(){let e=g_backgrounds[Math.floor(Math.random()*g_backgrounds.length)],t='url("'+e.url+'")',n=new Image;n.src=e.url,n.onload=function(){document.body.style.backgroundImage=t,document.getElementById("overlay").style.opacity=0}}get_background();